---
- name: Create Samba share on Host2 accessible to Host3
  hosts: file_servers
  become: yes
  tasks:

    - name: Update Packages
      apt:
        update_cache: yes
      tags:
      - update

    - name: Ensure latest Samba package
      ansible.builtin.package:
        name:
          - samba
        state: latest

    - name: Create directory for share
      ansible.builtin.file:
        path: /home/sambashare
        state: directory
        mode: '0755'

    - name: Update Samba configuration file
      ansible.builtin.blockinfile:
        path: /etc/samba/smb.conf
        backup: yes
        insertafter: EOF
        block: |
          [sambashare]
            comment = Samba on Ubuntu
            path = /home/username/sambashare
            read only = no
            browsable = yes